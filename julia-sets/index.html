<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Explorer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="fractal-canvas"></canvas>

    <!-- Julia preview mini-canvas (hidden by default) -->
    <canvas id="julia-preview" width="200" height="200"></canvas>

    <!-- Collapsible sidebar -->
    <aside id="sidebar">
        <h2>Fractal Explorer</h2>

        <!-- Fractal type tabs -->
        <div class="control-section">
            <h3>Fractal Type</h3>
            <div class="fractal-tabs">
                <button class="fractal-tab active" data-fractal="julia">Julia</button>
                <button class="fractal-tab" data-fractal="mandelbrot">Mandelbrot</button>
                <button class="fractal-tab" data-fractal="burningShip">Burning Ship</button>
                <button class="fractal-tab" data-fractal="newton">Newton</button>
                <button class="fractal-tab" data-fractal="phoenix">Phoenix</button>
            </div>
        </div>

        <!-- Presets -->
        <div class="control-section">
            <h3>Presets</h3>
            <div id="preset-grid" class="preset-grid"></div>
        </div>

        <!-- Guided journey -->
        <div class="control-section" id="journey-section">
            <h3>Guided Journey</h3>
            <select id="journey-select">
                <option value="">-- Select a Journey --</option>
            </select>
            <div class="button-group" style="margin-top: 8px;">
                <button id="journeyPrev" disabled>&#9664;</button>
                <button id="journeyPlay" disabled>Start Journey</button>
                <button id="journeyNext" disabled>&#9654;</button>
            </div>
            <div class="control-group">
                <label>Speed: <span id="journeySpeedValue">1.0</span></label>
                <input type="range" id="journeySpeed" min="0.2" max="3.0" value="1.0" step="0.1">
            </div>
        </div>

        <!-- Dynamic parameter sliders -->
        <div class="control-section">
            <h3>Parameters</h3>
            <div id="param-sliders"></div>
        </div>

        <!-- Iteration count -->
        <div class="control-section">
            <h3>Rendering</h3>
            <div class="control-group">
                <label>Max Iterations: <span id="maxIterValue">200</span></label>
                <input type="range" id="maxIter" min="50" max="2000" value="200" step="10">
            </div>
        </div>

        <!-- Color palette -->
        <div class="control-section">
            <h3>Color Palette</h3>
            <select id="palette-select">
                <option value="classic">Classic Blue-Gold</option>
                <option value="fire">Fire</option>
                <option value="ocean">Ocean</option>
                <option value="grayscale">Grayscale</option>
                <option value="rainbow">Rainbow</option>
                <option value="neon">Neon</option>
                <option value="ice">Ice</option>
                <option value="magma">Magma</option>
            </select>
            <div class="control-group" style="margin-top: 10px;">
                <label><input type="checkbox" id="colorCycleToggle"> Color Cycling</label>
            </div>
            <div class="control-group" id="colorCycleSpeedGroup" style="display: none;">
                <label>Cycle Speed: <span id="colorCycleSpeedValue">1.0</span></label>
                <input type="range" id="colorCycleSpeed" min="0.1" max="5.0" value="1.0" step="0.1">
            </div>
        </div>

        <!-- Coloring mode -->
        <div class="control-section">
            <h3>Coloring Mode</h3>
            <select id="color-mode">
                <option value="0">Smooth Iteration</option>
                <option value="1">Orbit Trap</option>
                <option value="2">Distance Estimation</option>
                <option value="3">Interior Coloring</option>
            </select>
        </div>

        <!-- Animation -->
        <div class="control-section" id="animation-section">
            <h3>Animation</h3>
            <div class="button-group">
                <button id="animToggle">Animate</button>
            </div>
            <div class="control-group">
                <label>Speed: <span id="animSpeedValue">1.0</span></label>
                <input type="range" id="animSpeed" min="0.01" max="2.0" value="1.0" step="0.1">
            </div>
        </div>

        <!-- Linked mode (visible only on Mandelbrot) -->
        <div class="control-section" id="linked-section" style="display: none;">
            <h3>Mandelbrot &rarr; Julia</h3>
            <div class="control-group">
                <label><input type="checkbox" id="linkedMode"> Show Julia preview on hover</label>
            </div>
            <p class="hint">Hover to preview, click to switch</p>
        </div>

        <!-- Actions -->
        <div class="control-section actions-section">
            <div class="button-group">
                <button id="resetView">Reset View</button>
                <button id="fullscreenBtn">Fullscreen</button>
            </div>
            <div class="control-group" style="margin-top: 8px;">
                <label><input type="checkbox" id="infiniteZoomToggle"> Infinite Zoom</label>
            </div>
        </div>

        <p class="hint">Scroll to zoom &middot; Drag to pan &middot; Press <kbd>?</kbd> for shortcuts</p>
    </aside>

    <!-- Sidebar toggle (AFTER sidebar in DOM for CSS ~ selector) -->
    <button id="sidebar-toggle" aria-label="Toggle controls">&#9776;</button>

    <!-- Waypoint label overlay -->
    <div id="waypoint-label" class="hidden"></div>

    <!-- Zoom depth indicator -->
    <div id="zoom-indicator"><span id="zoom-depth">1x</span></div>

    <!-- Keyboard shortcut overlay -->
    <div id="shortcut-overlay" class="hidden">
        <h3>Keyboard Shortcuts</h3>
        <table>
            <tr><td><kbd>Space</kbd></td><td>Toggle animation</td></tr>
            <tr><td><kbd>1</kbd> - <kbd>5</kbd></td><td>Switch fractal type</td></tr>
            <tr><td><kbd>R</kbd></td><td>Reset view</td></tr>
            <tr><td><kbd>C</kbd></td><td>Toggle color cycling</td></tr>
            <tr><td><kbd>&larr;</kbd> / <kbd>&rarr;</kbd></td><td>Cycle presets</td></tr>
            <tr><td><kbd>&uarr;</kbd> / <kbd>&darr;</kbd></td><td>Zoom in / out</td></tr>
            <tr><td><kbd>?</kbd></td><td>Show / hide this help</td></tr>
        </table>
    </div>

    <!-- Error display for debugging -->
    <div id="error-display"></div>

    <script type="module" src="js/main.js"></script>
    <script>
        // Catch module loading errors
        window.addEventListener('error', function(e) {
            var el = document.getElementById('error-display');
            if (el) {
                el.style.display = 'block';
                el.textContent = 'Error: ' + (e.message || e) + ' at ' + (e.filename || '') + ':' + (e.lineno || '');
            }
        });
    </script>
</body>
</html>
